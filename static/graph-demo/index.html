<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Struct-Size Chart</title>
  <style>
    body { background: #222; color: #eee }
    svg { margin: 0; }
  </style>
  <link rel="stylesheet" href="./chart.css">
</head>
<body>

<script type="module">

import { drawChart } from "./chart.js";

const loadDataFile = async url => {
  const response = await fetch(url);
  const text = await response.text();
  return text.trim().split('\n').map(line =>
    line.trim().split(/\s+/).map(Number)
  );
}

const loadByWidth = async width => ({
  data: await loadDataFile(`data/fields-${width}.dat`),
  label: `field size: ${width/8}b`
});

const loadData = async () => {
  const d8 = await loadByWidth(8);
  const d16 = await loadByWidth(16);
  const d32 = await loadByWidth(32);
  const d64 = await loadByWidth(64);
  return [d8, d16, d32, d64];
};

loadData().then(data => {

  const chartConfig = {
    width: 800,
    height: 500,
    maxTicks: {x: 10, y: 10},
    axisLabels: {
      x: 'Num elements',
      y: 'Time (ns/call)'
    },
    data,
  };

  let svg = drawChart(chartConfig);
  document.body.appendChild(svg);
});
</script>

</body
</html>
